# 持久化

## RDB

### RDB 文件的创建与载入

- 两个命令可以生成 RDB 文件
  - SAVE：阻塞 redis 进程（主线程），直至文件创建完毕。
  - BGSAVE：fork 一个子进程，由子进程去创建文件，不阻塞主进程。
- 服务器载入 RDB 文件会一直阻塞到载入工作完成。

## AOF

### 命令追加

- 客户端发送的写命令被服务端执行后，会以协议格式将被执行的写命令追加到服务器状态的 aof_buf 缓冲区的末尾。

### 命令写入与同步

- 被追加到 aof_buf 缓冲区的内容会调用某个函数判断是否需要写入和保存到 AOF 文件中。